<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Planning and Forecasting Dashboard</title>

    <!-- START: External CSS Libraries -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <!-- END: External CSS Libraries -->

    <!-- START: Custom CSS Styles -->
    <style>
        /* START: General Body Styles */
        body {
            font-family: "Roboto", sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        /* END: General Body Styles */

        /* START: Layout Styles */
        .page-content {
            padding: 24px;
        }
        .mdl-card {
            width: 100%;
            margin-bottom: 24px;
        }
        /* END: Layout Styles */

        /* START: Table Styles */
        .mdl-data-table {
            width: 100%;
            white-space: normal;
        }
        .mdl-data-table td,
        .mdl-data-table th {
            text-align: center;
            padding: 8px 4px;
        }
        .mdl-data-table .notes-column {
            width: 15%;
        }
        .mdl-data-table td.mdl-data-table__cell--non-numeric {
            text-align: left;
        }
        /* END: Table Styles */

        /* START: Forecasting Results Style */
        .mdl-typography--text-right {
            padding: 15px;
            margin-top: 15px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        /* END: Forecasting Results Style */

        /* START: View Toggle Styles */
        #weekly-view {
            display: none;
        }
        .view-toggle {
            margin: 20px 0;
        }
        /* END: View Toggle Styles */

        /* START: Year Group Styles */
        .year-group-2024 {
            background-color: #f5f5f5;
        }
        .year-group-2025 {
            background-color: #ffffff;
        }
        /* END: Year Group Styles */

        /* START: Add Promotion Button Style */
        .add-promotion-btn {
            margin: 20px 0;
            display: block;
        }
        /* END: Add Promotion Button Style */

        /* START: Editable Notes Styles */
        .editable-notes {
            min-height: 1.5em;
            padding: 4px;
            border: 1px solid transparent;
            transition: border-color 0.3s;
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .editable-notes:hover,
        .editable-notes:focus {
            border-color: rgba(0, 0, 0, 0.12);
            outline: none;
            white-space: normal;
            overflow: visible;
            max-width: none;
        }
        /* END: Editable Notes Styles */

        /* START: Price Ranking Styles */
        .price-ranking-1,
        .price-ranking-2,
        .price-ranking-3 {
            background-color: #c8e6c9;
        }
        .price-ranking-9,
        .price-ranking-10,
        .price-ranking-11 {
            background-color: #ffcdd2;
        }
        /* END: Price Ranking Styles */

        /* START: Sort Button Style */
        #sortButton {
            cursor: pointer;
            text-decoration: underline;
        }
        /* END: Sort Button Style */

        /* START: Week Row Styles */
        .week-row {
            cursor: pointer;
        }
        .expand-icon {
            vertical-align: middle;
            margin-right: 5px;
        }
        /* END: Week Row Styles */

        /* START: Daily Table Styles */
        .daily-table {
            width: 100%;
            border-collapse: collapse;
        }
        .daily-table th,
        .daily-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .daily-table th {
            background-color: #f2f2f2;
        }
        /* END: Daily Table Styles */

        /* START: Pricing Strategy Filter Buttons Styles */
        .price-strategy-filters {
            margin-bottom: 20px;
        }
        .price-strategy-filters button {
            margin-right: 10px;
        }
        /* END: Pricing Strategy Filter Buttons Styles */
    </style>
    <!-- END: Custom CSS Styles -->
</head>
<body>
    <!-- START: Main Layout Structure -->
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="mdl-layout__header">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">Price Planning and Forecasting Dashboard</span>
            </div>
        </header>

        <main class="mdl-layout__content">
            <div class="page-content">
                <!-- START: Select Season and Price Group Card -->
                <div class="mdl-card mdl-shadow--2dp">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Select Season</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                            <select class="mdl-textfield__input" id="season-select">
                                <option value=""></option>
                                <option value="spring-2025">Spring 2025</option>
                                <option value="fall-2025">Fall 2025</option>
                                <option value="spring-2026">Spring 2026</option>
                                <option value="fall-2026">Fall 2026</option>
                            </select>
                            <label class="mdl-textfield__label" for="season-select">Season</label>
                        </div>
                    </div>
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Select Style</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width: 100%">
                            <input class="mdl-textfield__input" type="text" id="product-search">
                            <label class="mdl-textfield__label" for="product-search">Search Style Code or Name</label>
                        </div>
                        <div id="autocomplete-results" class="mdl-card__actions"></div>
                    </div>
                </div>
                <!-- END: Select Season and Price Group Card -->

                <h5 id="selected-style"></h5>

                <!-- START: White Ticket Section -->
                <div class="mdl-card mdl-shadow--2dp">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">White Ticket</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <p>Below you will find price points ranked by their total sales dollars.</p>
                    </div>

                    <!-- START: Price Strategy Filter Buttons -->
                    <div class="mdl-card__supporting-text">
                        <div class="price-strategy-filters">
    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" data-strategy="Price strategy 1">
        Price strategy 1
    </button>
    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" data-strategy="Price strategy 2">
        Price strategy 2
    </button>
    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" data-strategy="Price strategy 3">
        Price strategy 3
    </button>
                           <p><br>Choosing a price strategy will change the table below</p>
                        </div>
                    </div>
                    <!-- END: Price Strategy Filter Buttons -->

                    <!-- START: White Ticket Table -->
                    <div class="mdl-card__supporting-text">
                        <table class="mdl-data-table mdl-js-data-table" id="white-ticket-table">
                            <thead>
                                <tr>
                                    <th class="mdl-data-table__cell--non-numeric">White Ticket</th>
                                    <th>$9.99</th>
                                    <th>$10.99</th>
                                    <th>$11.99</th>
                                    <th>$12.99</th>
                                    <th>$13.99</th>
                                    <th>$14.99</th>
                                    <th>$15.99</th>
                                    <th>$16.99</th>
                                    <th>$17.99</th>
                                    <th>$18.99</th>
                                    <th>$19.99</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Table body will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <!-- END: White Ticket Table -->
                </div>
                <!-- END: White Ticket Section -->

                <!-- START: Promotional Calendar Section -->
                <div class="mdl-card mdl-shadow--2dp content-card">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Price History</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <p>Below you can view last seasons pricing at a promotion event level or a daily level.</p>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <div class="view-toggle">
                            <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="view-toggle">
                                <input type="checkbox" id="view-toggle" class="mdl-switch__input">
                                <span class="mdl-switch__label">View by day</span>
                            </label>
                        </div>

                        <!-- START: Yearly View -->
                        <div id="yearly-view">
                            <h4>Last Year (Spring 2024)</h4>
                            <table class="mdl-data-table mdl-js-data-table" id="promotions-data-2024">
                                <thead>
                                    <tr>
                                        <th class="mdl-data-table__cell--non-numeric">Promotion</th>
                                        <th>Price</th>
                                        <th>AUR</th>
                                        <th class="mdl-data-table__cell--non-numeric">Dates</th>
                                        <th>Units</th>
                                        <th>Sales</th>
                                        <th class="mdl-data-table__cell--non-numeric">Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Yearly view data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        <!-- END: Yearly View -->

                        <!-- START: Weekly View -->
                        <div id="weekly-view" style="display: none">
                            <table class="mdl-data-table mdl-js-data-table" id="weekly-data">
                                <thead>
                                    <tr>
                                        <th class="mdl-data-table__cell--non-numeric">Week</th>
                                        <th>Price</th>
                                        <th>AUR</th>
                                        <th>Units</th>
                                        <th>Revenue</th>
                                        <th>Inventory</th>
                                        <th>MMU</th>
                                        <th class="mdl-data-table__cell--non-numeric">Promotion</th>
                                        <th class="mdl-data-table__cell--non-numeric notes-column">Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Weekly data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        <!-- END: Weekly View -->
                    </div>
                </div>
                <!-- END: Promotional Calendar Section -->

                <!-- START: Combined Forecasting and This Year Projected Card -->
                <div class="mdl-card mdl-shadow--2dp content-card">
                    <div class="mdl-card__title">
                        <h2 class="mdl-card__title-text">Forecasting (Spring 2025)</h2>
                    </div>
                    <div class="mdl-card__supporting-text">
                        <p>This tool enables you to choose last season's event and manually forecast what a different price point may produce in the upcoming season. After calculating the forecast for the price point results, if you like the results you can populate them in the This Year Plan table below.</p>

                        <!-- START: Forecasting Form -->
                        <form id="forecast-form" class="forecast-form">
                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <select class="mdl-textfield__input" id="promotion-select">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                                <label class="mdl-textfield__label" for="promotion-select">Select Promotion</label>
                            </div>
                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                <input class="mdl-textfield__input" type="number" id="price" step="0.01" min="0">
                                <label class="mdl-textfield__label" for="price">Enter New Price</label>
                            </div>
                            <br>
                            <button type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
                                Calculate Forecast
                            </button>
                        </form>
                        <!-- END: Forecasting Form -->

                       <!-- START: Forecast Results -->
                        <div id="forecast-results" class="forecast-results">
                            <br>
                            <p>Projected Units: <span id="calculated-units"></span></p>
                            <p>Projected Revenue: <span id="calculated-revenue"></span></p>
                        </div>
                        <!-- END: Forecast Results -->

                        <button type="button" id="update-table" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary" disabled>
                            Update Table with New Forecast
                        </button>

                        <!-- START: This Year Projected Table -->
                        <h4>This Year Projected (Spring 2025)</h4>
                        <table class="mdl-data-table mdl-js-data-table" id="promotions-data">
                            <thead>
                                <tr>
                                    <th class="mdl-data-table__cell--non-numeric">Promotion</th>
                                    <th>Price</th>
                                    <th>AUR</th>
                                    <th>Units</th>
                                    <th>Sales</th>
                                    <th>Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Promotion rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                        <!-- END: This Year Projected Table -->
                    </div>
                </div>
                <!-- END: Combined Forecasting and This Year Projected Card -->
            </div>
        </main>
    </div>
    <!-- END: Main Layout Structure -->

    <!-- START: External JavaScript Libraries -->
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <!-- END: External JavaScript Libraries -->

    <!-- START: Custom JavaScript -->
    <script>
        // COMMENT 1: Start of DOMContentLoaded event listener
        document.addEventListener("DOMContentLoaded", function () {
            console.log("DOM fully loaded and parsed");

          // COMMENT 2: Define strategies object (make sure this is correctly defined with all your data)
const strategies = {
    'Price strategy 1': [
        ["Cost", 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75],
        ["Projected Units", 3824, 3258, 2782, 2382, 2045, 1762, 1524, 1325, 1159, 1020, 904],
        ["Projected Sales Dollars", 38192, 35805, 33335, 30932, 28609, 26402, 24368, 22501, 20849, 19369, 18080],
        ["Projected IMU", "42%", "47%", "52%", "55%", "58%", "61%", "64%", "66%", "68%", "69%", "71%"],
        ["Ranking by profit", 6, 3, 1, 2, 4, 5, 7, 8, 9, 10, 11]
    ],
    'Price strategy 2': [
        ["Cost", 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75],
        ["Projected Units", 4200, 3580, 3060, 2620, 2250, 1940, 1680, 1460, 1280, 1120, 990],
        ["Projected Sales Dollars", 41958, 39344, 36689, 34033, 31447, 29080, 26843, 24785, 23027, 21437, 19790],
        ["Projected IMU", "40%", "45%", "50%", "53%", "56%", "59%", "62%", "64%", "66%", "67%", "69%"],
        ["Ranking by profit", 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
    ],
    'Price strategy 3': [
        ["Cost", 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75, 5.75],
        ["Projected Units", 3450, 2940, 2510, 2150, 1840, 1590, 1370, 1190, 1040, 920, 810],
        ["Projected Sales Dollars", 34465, 32290, 30094, 27928, 25741, 23834, 21885, 20207, 18709, 17460, 16191],
        ["Projected IMU", "44%", "49%", "54%", "57%", "60%", "63%", "66%", "68%", "70%", "71%", "73%"],
        ["Ranking by profit", 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]
    ]
};

// COMMENT 3: Select strategy buttons and add event listeners
const strategyButtons = document.querySelectorAll('.price-strategy-filters button');
console.log("Found strategy buttons:", strategyButtons.length);

strategyButtons.forEach(button => {
    console.log("Adding click listener to button:", button.textContent.trim(), "with data-strategy:", button.dataset.strategy);
    button.addEventListener('click', changeStrategy);
});

// COMMENT 4: Strategy change function
function changeStrategy(e) {
    // Find the button element
    let buttonElement = e.target;
    while (buttonElement && !buttonElement.classList.contains('mdl-button')) {
        buttonElement = buttonElement.parentElement;
    }

    if (!buttonElement) {
        console.error("Button element not found");
        return;
    }

    console.log("Button clicked:", buttonElement);
    console.log("Button dataset:", buttonElement.dataset);
    console.log("Button text content:", buttonElement.textContent.trim());

    let strategy = buttonElement.dataset.strategy;
    if (!strategy) {
        strategy = buttonElement.textContent.trim();
        console.warn("Strategy not found in dataset, using button text:", strategy);
    }

    console.log("Identified strategy:", strategy);
    updateWhiteTicketTable(strategy);
    
    // Update button styles
    strategyButtons.forEach(btn => btn.classList.remove('mdl-button--accent'));
    buttonElement.classList.add('mdl-button--accent');
}

// COMMENT 5: Update White Ticket table function
function updateWhiteTicketTable(strategy) {
    console.log("Updating table with strategy:", strategy);
    const table = document.getElementById('white-ticket-table');
    if (!table) {
        console.error("Table not found!");
        return;
    }
    const tbody = table.querySelector('tbody');
    if (!tbody) {
        console.error("Table body not found!");
        return;
    }
    
    console.log("Current table rows:", tbody.rows.length);

    // Clear existing rows
    tbody.innerHTML = '';
    
    console.log("Rows after clearing:", tbody.rows.length);

    // Normalize strategy name to match object keys
    const normalizedStrategy = Object.keys(strategies).find(key => 
        key.toLowerCase() === strategy.toLowerCase()
    );

    if (!normalizedStrategy || !strategies[normalizedStrategy]) {
        console.error("Strategy not found:", strategy);
        console.log("Available strategies:", Object.keys(strategies));
        return;
    }

    console.log("Strategy data found:", strategies[normalizedStrategy]);

    // Populate the table with the selected strategy's data
    strategies[normalizedStrategy].forEach((row, index) => {
        const newRow = tbody.insertRow();
        newRow.insertCell().textContent = row[0];
        for (let i = 1; i < row.length; i++) {
            const cell = newRow.insertCell();
            cell.textContent = typeof row[i] === 'number' ? row[i].toLocaleString() : row[i];
            if (row[0] === "Ranking by profit") {
                cell.classList.add(`price-ranking-${row[i]}`);
            }
        }
        console.log(`Row ${index} inserted:`, row[0]);
    });

    console.log("Final table rows:", tbody.rows.length);
    console.log("Table updated with strategy:", normalizedStrategy);
}

// COMMENT 6: Initialize with default strategy
console.log("Initializing with default strategy");
updateWhiteTicketTable('Price strategy 1');
            // COMMENT 7: Start of White Ticket Section
            let ascending = true;
            const sortButton = document.getElementById("sortButton");
            if (sortButton) {
                sortButton.addEventListener("click", sortColumns);
            }

            // COMMENT 8: Sort columns function
            function sortColumns() {
                const table = document.getElementById("white-ticket-table");
                const rows = Array.from(table.rows);
                const priceRankingRow = rows[rows.length - 1];
                const headerRow = rows[0];
                const columns = Array.from(priceRankingRow.cells).slice(1);

                columns.sort((a, b) => {
                    const rankA = parseInt(a.textContent);
                    const rankB = parseInt(b.textContent);
                    return ascending ? rankA - rankB : rankB - rankA;
                });

                for (let i = 0; i < columns.length; i++) {
                    const columnIndex = columns[i].cellIndex;
                    for (let j = 0; j < rows.length; j++) {
                        const cell = rows[j].cells[columnIndex];
                        rows[j].appendChild(cell);
                    }
                }

                ascending = !ascending;
            }

            // COMMENT 9: Select DOM elements
            const form = document.getElementById("forecast-form");
            const updateTableButton = document.getElementById("update-table");
            const promotionSelect = document.getElementById("promotion-select");
            const promotionsTable = document.getElementById("promotions-data");
            const priceInput = document.getElementById("price");
            const calculatedUnitsElement = document.getElementById("calculated-units");
            const calculatedRevenueElement = document.getElementById("calculated-revenue");
            const viewToggle = document.getElementById("view-toggle");
            const yearlyView = document.getElementById("yearly-view");
            const weeklyView = document.getElementById("weekly-view");

            // COMMENT 10: State variables
            let calculatedUnits, calculatedRevenue;
            let currentProduct = { price: 19.99 };

            // COMMENT 11: Sample promotions data
            const promotions = [
                { name: "Regular Price", currentPrice: 19.99, discount: 0 },
                { name: "LPS", currentPrice: 12.99, discount: 0 },
                { name: "Two Day Sale", currentPrice: 14.99, discount: 0 },
                { name: "EPIC deals", currentPrice: 10.99, discount: 0 },
                { name: "Credit Event", currentPrice: 15.99, discount: 0 },
                { name: "Main Sale", currentPrice: 14.99, discount: 0 },
                { name: "Black Friday", currentPrice: 10.99, discount: 0 },
            ];

            // COMMENT 12: Event Listeners
            if (form) form.addEventListener("submit", handleForecastSubmit);
            if (updateTableButton) updateTableButton.addEventListener("click", updateTablesAndClear);
            if (viewToggle) viewToggle.addEventListener("change", toggleView);

            // COMMENT 13: Initialize
            populatePromotionDropdown();
            populatePromotionsTable();

            // COMMENT 14: Handle forecast submit function
            function handleForecastSubmit(e) {
                e.preventDefault();
                const price = parseFloat(priceInput.value);

                calculatedUnits = Math.round(100000 / price);
                calculatedRevenue = price * calculatedUnits;

                calculatedUnitsElement.textContent = calculatedUnits.toLocaleString();
                calculatedRevenueElement.textContent = "$" + calculatedRevenue.toLocaleString(undefined, {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2,
                });

                updateTableButton.disabled = false;
            }

            // COMMENT 15: Update promotion data function
            function updatePromotionData(index, newPrice) {
                promotions[index].currentPrice = newPrice;
            }

            // COMMENT 16: Update tables and clear function
            function updateTablesAndClear() {
                const price = parseFloat(priceInput.value);
                const selectedPromoIndex = parseInt(promotionSelect.value);

                if (selectedPromoIndex < promotions.length) {
                    promotions[selectedPromoIndex].currentPrice = price;
                    promotions[selectedPromoIndex].units = calculatedUnits;
                    promotions[selectedPromoIndex].sales = calculatedRevenue;
                    promotions[selectedPromoIndex].AUR = calculateAUR(price);
                }

                populatePromotionsTable();
                populatePromotionDropdown();

                calculatedUnits = null;
                calculatedRevenue = null;
                calculatedUnitsElement.textContent = "";
                calculatedRevenueElement.textContent = "";
                priceInput.value = "";

                updateTableButton.disabled = true;
                priceInput.parentElement.classList.remove("is-dirty");
            }

            // COMMENT 17: Add price event listeners function
            function addPriceEventListeners() {
                console.log("Adding price event listeners");
                const tbody = promotionsTable.querySelector("tbody");
                tbody.addEventListener("input", function (e) {
                    if (e.target && e.target.cellIndex === 1) {
                        console.log("Price cell edited");
                        const row = e.target.parentElement;
                        const priceCell = e.target;
                        const aurCell = row.cells[2];
                        const price = parseFloat(priceCell.textContent.replace("$", ""));
                        if (!isNaN(price)) {
                            const AUR = calculateAUR(price);
                            aurCell.textContent = "$" + AUR.toFixed(2);
                        }
                    }
                });
            }

            // COMMENT 18: Populate promotion dropdown function
            function populatePromotionDropdown() {
                promotionSelect.innerHTML = "";
                promotions.forEach((promo, index) => {
                    const option = document.createElement("option");
                    option.value = index;
                    const price = promo.currentPrice || (currentProduct ? currentProduct.price * (1 - promo.discount) : 0);
                    let dateRange = "";
                    if (promo.startDate && promo.endDate) {
                        dateRange = ` (${promo.startDate} to ${promo.endDate})`;
                    }
                    option.textContent = `${promo.name}${dateRange} (Current: $${price.toFixed(2)})`;
                    promotionSelect.appendChild(option);
                });
            }

            // COMMENT 19: Populate promotions table function
            function populatePromotionsTable() {
                console.log("Populating promotions table");
                try {
                    const tbody = promotionsTable.querySelector("tbody");
                    tbody.innerHTML = "";

                    promotions.forEach((promo, index) => {
                        const row = tbody.insertRow();
                        const price = promo.currentPrice || (currentProduct ? currentProduct.price * (1 - promo.discount) : 0);
                        const AUR = calculateAUR(price);
                        const units = promo.units || 30000;
                        const sales = promo.sales || price * units;
                        row.innerHTML = `
                            <td class="mdl-data-table__cell--non-numeric">${promo.name}</td>
                            <td>$${price.toFixed(2)}</td>
                            <td>$${AUR.toFixed(2)}</td>
                            <td>${units.toLocaleString()}</td>
                            <td>$${sales.toFixed(2)}</td>
                            <td class="mdl-data-table__cell--non-numeric notes-column">
                                <div contenteditable="true" class="editable-notes" data-table="promotions" data-row="${index}">${promo.notes || ""}</div>
                            </td>
                        `;
                    });

                    addPriceEventListeners();
                } catch (error) {
                    console.error("Error in populatePromotionsTable:", error);
                }
            }

            // COMMENT 20: Calculate AUR function
            function calculateAUR(price) {
                return price * 0.62;
            }

            // COMMENT 21: Toggle view function
            function toggleView() {
                if (viewToggle.checked) {
                    yearlyView.style.display = "none";
                    weeklyView.style.display = "block";
                    populateWeeklyData();
                } else {
                    yearlyView.style.display = "block";
                    weeklyView.style.display = "none";
                }
            }

            // COMMENT 22: Populate weekly data function
            function populateWeeklyData() {
                const weeklyData = [
                    { week: 1, price: 14.99, AUR: 14.99 * 0.62, units: 577, revenue: 46155.23, inventory: 10000, mmu: "50%", promotion: "Regular Price", notes: "" },
                    { week: 2, price: 14.99, AUR: 14.99 * 0.62, units: 592, revenue: 47354.08, inventory: 9408, mmu: "50%", promotion: "Regular Price", notes: "" },
                    { week: 5, price: 14.99, AUR: 14.99 * 0.62, units: 600, revenue: 47994.0, inventory: 8808, mmu: "50%", promotion: "Regular Price", notes: "" },
                    { week: 9, price: 11.99, AUR: 11.99 * 0.62, units: 800, revenue: 59992.0, inventory: 8008, mmu: "45%", promotion: "Main Sale", notes: "" },
                    { week: 14, price: 11.99, AUR: 11.99 * 0.62, units: 850, revenue: 63741.5, inventory: 7158, mmu: "45%", promotion: "Main Sale", notes: "" },
                    { week: 18, price: 14.99, AUR: 14.99 * 0.62, units: 1000, revenue: 69990.0, inventory: 6158, mmu: "40%", promotion: "Regular Price", notes: "" },
                    { week: 22, price: 13.99, AUR: 14.99 * 0.62, units: 1200, revenue: 71988.0, inventory: 4958, mmu: "35%", promotion: "Two Day Sale", notes: "" },
                    { week: 27, price: 14.99, AUR: 14.99 * 0.62, units: 1100, revenue: 71489.0, inventory: 3858, mmu: "40%", promotion: "Epic Deals", notes: "" },
                    { week: 31, price: 13.99, AUR: 13.99 * 0.62, units: 950, revenue: 66490.5, inventory: 2908, mmu: "45%", promotion: "Back to School", notes: "" },
                    { week: 36, price: 11.99, AUR: 11.99 * 0.62, units: 800, revenue: 59992.0, inventory: 2108, mmu: "50%", promotion: "Credit Event", notes: "" },
                    { week: 40, price: 14.99, AUR: 14.99 * 0.62, units: 700, revenue: 55993.0, inventory: 1408, mmu: "50%", promotion: "Regular Price", notes: "" },
                    { week: 45, price: 14.99, AUR: 14.99 * 0.62, units: 1500, revenue: 89985.0, inventory: -92, mmu: "30%", promotion: "Black Friday", notes: "" },
                    { week: 49, price: 13.99, AUR: 13.99 * 0.62, units: 1000, revenue: 69990.0, inventory: -1092, mmu: "40%", promotion: "Credit Event", notes: "" },
                ];

                const tbody = document.querySelector("#weekly-data tbody");
                tbody.innerHTML = "";
                weeklyData.forEach((week, index) => {
                    const weekRow = tbody.insertRow();
                    weekRow.classList.add("week-row");
                    weekRow.innerHTML = `
                        <td class="mdl-data-table__cell--non-numeric">
                            <i class="material-icons expand-icon">add_circle_outline</i> Week ${week.week}
                        </td>
                        <td>$${week.price.toFixed(2)}</td>
                        <td>$${week.AUR.toFixed(2)}</td>
                        <td>${week.units.toLocaleString()}</td>
                        <td>$${week.revenue.toFixed(2)}</td>
                        <td>${week.inventory.toLocaleString()}</td>
                        <td>${week.mmu}</td>
                        <td class="mdl-data-table__cell--non-numeric">${week.promotion}</td>
                        <td class="mdl-data-table__cell--non-numeric notes-column">
                            <div contenteditable="true" class="editable-notes" data-table="weekly" data-row="${index}">${week.notes}</div>
                        </td>
                    `;

                    // Add click event to expand/collapse
                    weekRow.querySelector(".expand-icon").addEventListener("click", function () {
                        toggleDailyData(this, week.week);
                    });

                    // Create a row for daily data (initially hidden)
                    const dailyRow = tbody.insertRow();
                    dailyRow.classList.add("daily-data");
                    dailyRow.style.display = "none";
                    dailyRow.innerHTML = `
                        <td colspan="9">
                            <table class="mdl-data-table mdl-js-data-table daily-table">
                                <thead>
                                    <tr>
                                        <th>Day</th>
                                        <th>Price</th>
                                        <th>Units</th>
                                        <th>Revenue</th>
                                        <th>Marketing</th>
                                        <th>Promotion</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Daily data will be populated here -->
                                </tbody>
                            </table>
                        </td>
                    `;
                });

                addTotals(weeklyData);
            }

            // COMMENT 23: Add totals function
            function addTotals(data) {
                const totals = data.reduce((acc, week) => {
                    acc.units += week.units;
                    acc.revenue += week.revenue;
                    return acc;
                }, { units: 0, revenue: 0 });

                const tbody = document.querySelector("#weekly-data tbody");
                const totalRow = tbody.insertRow();
                totalRow.innerHTML = `
                    <td colspan="3" class="mdl-data-table__cell--non-numeric"><strong>Total</strong></td>
                    <td><strong>${totals.units.toLocaleString()}</strong></td>
                    <td><strong>$${totals.revenue.toFixed(2)}</strong></td>
                    <td colspan="4"></td>
                `;
            }

            // COMMENT 24: Toggle daily data function
            function toggleDailyData(icon, weekNumber) {
                const weekRow = icon.closest("tr");
                const dailyRow = weekRow.nextElementSibling;
                const isExpanded = icon.textContent === "remove_circle_outline";

                if (isExpanded) {
                    icon.textContent = "add_circle_outline";
                    dailyRow.style.display = "none";
                } else {
                    icon.textContent = "remove_circle_outline";
                    dailyRow.style.display = "table-row";
                    populateDailyData(dailyRow, weekNumber);
                }
            }

            // COMMENT 25: Populate daily data function
            function populateDailyData(dailyRow, weekNumber) {
                const dailyTable = dailyRow.querySelector(".daily-table tbody");
                dailyTable.innerHTML = "";

                // Sample daily data - replace with your actual data
                const dailyData = [
                    { day: "Monday", price: 14.99, units: 100, revenue: 7999, marketing: "45% off Mystery Offer", promotion: "Regular Price" },
                    { day: "Tuesday", price: 14.99, units: 95, revenue: 7599.05, marketing: "$5 RTKC", promotion: "Regular Price" },
                    { day: "Wednesday", price: 14.99, units: 105, revenue: 8398.95, marketing: "$20 off $100 offer", promotion: "Regular Price" },
                    { day: "Thursday", price: 11.99, units: 90, revenue: 6749.1, marketing: "M25% GPO (In Store Use Only)", promotion: "Credit Event" },
                    { day: "Friday", price: 11.99, units: 110, revenue: 8248.9, marketing: "15% off Credit Event Scratch Off Barcode", promotion: "Credit Event" },
                    { day: "Saturday", price: 14.99, units: 130, revenue: 10398.7, marketing: "25% off Mystery Offer", promotion: "Three day sale" },
                    { day: "Sunday", price: 14.99, units: 120, revenue: 9598.8, marketing: "Kohl's Card 30% Offer", promotion: "Epic Deals" },
                ];

                dailyData.forEach((day) => {
                    const row = dailyTable.insertRow();
                    const AUR = day.price * 0.62;
                    row.innerHTML = `
                        <td>${day.day}</td>
                        <td>$${day.price.toFixed(2)}</td>
                        <td>${day.units}</td>
                        <td>$${day.revenue.toFixed(2)}</td>
                        <td>${day.marketing}</td>
                        <td>${day.promotion}</td>
                    `;
                });
            }

// COMMENT 35: Populate Last Year's promotion data
function populateLastYearPromotions() {
    console.log("Populating Last Year's promotion data");
    const tbody = document.querySelector("#promotions-data-2024 tbody");
    if (!tbody) {
        console.error("Table body for last year's promotions not found");
        return;
    }

    const lastYearPromotions = [
        { promotion: "Regular Price", price: 19.99, AUR: 13.78, dates: "Jan 1 - Feb 2", units: 50000, sales: 1000000.00, notes: "" },
        { promotion: "Main Sale", price: 14.99, AUR: 8.54, dates: "Feb 23 - Feb 26", units: 10000, sales: 150000.00, notes: "" },
        { promotion: "LPS", price: 12.99, AUR: 6.40, dates: "Mar 1 - Mar 3", units: 50000, sales: 1000000.00, notes: "" },
        { promotion: "Epic Deals", price: 10.99, AUR: 7.70, dates: "Mar 16 - Mar 22", units: 50000, sales: 1000000.00, notes: "" },
        { promotion: "Credit Event", price: 15.99, AUR: 10.02, dates: "Apr 4 - Apr 7", units: 50000, sales: 1000000.00, notes: "" }
    ];

    tbody.innerHTML = "";
    lastYearPromotions.forEach((promo, index) => {
        const row = tbody.insertRow();
        row.innerHTML = `
            <td class="mdl-data-table__cell--non-numeric">${promo.promotion}</td>
            <td>$${promo.price.toFixed(2)}</td>
            <td>$${promo.AUR.toFixed(2)}</td>
            <td class="mdl-data-table__cell--non-numeric">${promo.dates}</td>
            <td>${promo.units.toLocaleString()}</td>
            <td>$${promo.sales.toFixed(2)}</td>
            <td class="mdl-data-table__cell--non-numeric notes-column">
                <div contenteditable="true" class="editable-notes" data-table="lastYear" data-row="${index}">${promo.notes}</div>
            </td>
        `;
    });
    console.log("Last Year's promotion data populated");
}

// COMMENT 36: Call the function to populate Last Year's promotion data
// Add this line in the DOMContentLoaded event listener, after populatePromotionsTable();
populateLastYearPromotions();

            // COMMENT 26: Product search functionality
            const productSearch = document.getElementById("product-search");
            const autocompleteResults = document.getElementById("autocomplete-results");

            // COMMENT 27: Sample product data
            const products = [
                { code: "58775216", name: "MEN'S NIKE DRI FIT FORM HOODED JACKET", price: 19.99 },
                { code: "50093716", name: "NIKE STAR RUNNER NN", price: 14.99 },
                { code: "58730148", name: "BOYS RAIN JACKET", price: 11.99 },
                { code: "83178349", name: "FITBIT CHARGE 6 BLACK", price: 13.99 },
                { code: "77404421", name: "Nike Sportswear Essential Women's Leggings", price: 14.99 },
            ];

            if (productSearch) {
                productSearch.addEventListener("input", handleProductSearch);
                productSearch.addEventListener("focus", handleProductFocus);
                productSearch.addEventListener("input", handleProductInput);
            }
            document.addEventListener("click", closeAutocomplete);

            // COMMENT 28: Handle product search function
            function handleProductSearch() {
                const input = this.value.toLowerCase();
                const results = products.filter(product => 
                    product.code.toLowerCase().includes(input) || 
                    product.name.toLowerCase().includes(input)
                );
                displayAutocompleteResults(results);
            }

            // COMMENT 29: Handle product focus function
            function handleProductFocus() {
                if (this.value === "") {
                    displayAutocompleteResults(products);
                }
            }

            // COMMENT 30: Handle product input function
            function handleProductInput() {
                if (this.value.length > 0) {
                    this.parentElement.classList.add("is-dirty");
                } else {
                    this.parentElement.classList.remove("is-dirty");
                }
            }

            // COMMENT 31: Display autocomplete results function
            function displayAutocompleteResults(results) {
                autocompleteResults.innerHTML = "";
                if (results.length === 0) {
                    autocompleteResults.style.display = "none";
                    return;
                }

                results.forEach((result) => {
                    const div = document.createElement("div");
                    div.textContent = `${result.code} - ${result.name}`;
                    div.className = "autocomplete-item mdl-button mdl-js-button mdl-js-ripple-effect";
                    div.addEventListener("click", () => selectProduct(result));
                    autocompleteResults.appendChild(div);
                });

                autocompleteResults.style.display = "block";
            }

            // COMMENT 32: Select product function
            function selectProduct(product) {
                currentProduct = product;
                productSearch.value = `${product.code} - ${product.name}`;
                autocompleteResults.style.display = "none";
                productSearch.parentElement.classList.add("is-dirty");
                componentHandler.upgradeElement(productSearch.parentElement);
                document.getElementById("selected-style").innerHTML = productSearch.value;
                console.log("Selected product:", product);
            }

            // COMMENT 33: Close autocomplete function
            function closeAutocomplete(e) {
                if (!productSearch.contains(e.target) && !autocompleteResults.contains(e.target)) {
                    autocompleteResults.style.display = "none";
                }
            }
        });
        // COMMENT 34: End of DOMContentLoaded event listener
    </script>
    <!-- END: Custom JavaScript -->
</body>
</html>
