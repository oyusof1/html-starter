<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Price Planning and Forecasting Dashboard</title>

    <!-- Material Design Lite CSS -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link
      rel="stylesheet"
      href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css"
    />

    <!-- Custom CSS Styles -->
    <style>
      /* General Body Styles */
      body {
        font-family: "Roboto", sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }

      /* Layout Styles */
      .page-content {
        padding: 24px;
      }
      .mdl-card {
        width: 100%;
        margin-bottom: 24px;
      }

      /* Table Styles */
      .mdl-data-table {
        width: 100%;
        white-space: normal;
      }
      .mdl-data-table td,
      .mdl-data-table th {
        text-align: center;
        padding: 8px 4px;
      }
      .mdl-data-table .notes-column {
        width: 15%;
      }
      .mdl-data-table td.mdl-data-table__cell--non-numeric {
        text-align: left;
      }

      /* Forecasting Results Style */
      .mdl-typography--text-right {
        padding: 15px;
        margin-top: 15px;
        background-color: #f5f5f5;
        border-radius: 4px;
      }

      /* View Toggle Styles */
      #weekly-view {
        display: none;
      }
      .view-toggle {
        margin: 20px 0;
      }

      /* Year Group Styles */
      .year-group-2024 {
        background-color: #f5f5f5;
      }
      .year-group-2025 {
        background-color: #ffffff;
      }

      /* Add Promotion Button Style */
      .add-promotion-btn {
        margin: 20px 0;
        display: block;
      }

      /* Editable Notes Styles */
      .editable-notes {
        min-height: 1.5em;
        padding: 4px;
        border: 1px solid transparent;
        transition: border-color 0.3s;
        max-width: 200px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .editable-notes:hover,
      .editable-notes:focus {
        border-color: rgba(0, 0, 0, 0.12);
        outline: none;
        white-space: normal;
        overflow: visible;
        max-width: none;
      }

      /* Price Ranking Styles */
      .price-ranking-1,
      .price-ranking-2,
      .price-ranking-3 {
        background-color: #c8e6c9;
      }
      .price-ranking-9,
      .price-ranking-10,
      .price-ranking-11 {
        background-color: #ffcdd2;
      }

      /* Sort Button Style */
      #sortButton {
        cursor: pointer;
        text-decoration: underline;
      }

      /* Week Row Styles */
      .week-row {
        cursor: pointer;
      }
      .expand-icon {
        vertical-align: middle;
        margin-right: 5px;
      }

      /* Daily Table Styles */
      .daily-table {
        width: 100%;
        border-collapse: collapse;
      }
      .daily-table th,
      .daily-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      .daily-table th {
        background-color: #f2f2f2;
      }
      .mdl-textfield.mdl-js-textfield.mdl-textfield--floating-label.is-dirty.is-upgraded {
        padding-right: 1rem;
      }
    </style>
  </head>
  <body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
      <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
          <span class="mdl-layout-title"
            >Price Planning and Forecasting Dashboard</span
          >
        </div>
      </header>

      <main class="mdl-layout__content">
        <div class="page-content">
          <!-- Select Season and Price Group Card -->
          <div class="mdl-card mdl-shadow--2dp">
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text">Select Season</h2>
            </div>
            <div class="mdl-card__supporting-text">
              <div
                class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label"
              >
                <select class="mdl-textfield__input" id="season-select">
                  <option value=""></option>
                  <option value="spring-2025">Spring 2025</option>
                  <option value="fall-2025">Fall 2025</option>
                  <option value="spring-2026">Spring 2026</option>
                  <option value="fall-2026">Fall 2026</option>
                </select>
                <label class="mdl-textfield__label" for="season-select"
                  >Season</label
                >
              </div>
            </div>
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text">Select Style</h2>
            </div>
            <div class="mdl-card__supporting-text">
              <div
                class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label"
                style="width: 100%"
              >
                <input
                  class="mdl-textfield__input"
                  type="text"
                  id="product-search"
                />
                <label class="mdl-textfield__label" for="product-search"
                  >Search Style Code or Name</label
                >
              </div>
              <div id="autocomplete-results" class="mdl-card__actions"></div>
            </div>
          </div>

          <h5 id="selected-style"></h5>
          <!-- White Ticket Section -->
          <div class="mdl-card mdl-shadow--2dp">
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text">White Ticket</h2>
            </div>
            <div class="mdl-card__supporting-text">
              <p>
                Below you will find price points ranked by their total sales
                dollars.
              </p>
            </div>
            <div class="mdl-card__supporting-text">
              <table
                class="mdl-data-table mdl-js-data-table"
                id="white-ticket-table"
              >
                <thead>
                  <tr>
                    <th class="mdl-data-table__cell--non-numeric">
                      White Ticket
                    </th>
                    <th>$9.99</th>
                    <th>$10.99</th>
                    <th>$11.99</th>
                    <th>$12.99</th>
                    <th>$13.99</th>
                    <th>$14.99</th>
                    <th>$15.99</th>
                    <th>$16.99</th>
                    <th>$17.99</th>
                    <th>$18.99</th>
                    <th>$19.99</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="mdl-data-table__cell--non-numeric">Cost</td>
                    <td>5.75</td>
                    <td>5.75</td>
                    <td>5.75</td>
                    <td>5.75</td>
                    <td>5.75</td>
                    <td>5.75</td>
                    <td>5.75</td>
                    <td>5.75</td>
                    <td>5.75</td>
                    <td>5.75</td>
                    <td>5.75</td>
                  </tr>
                  <tr>
                    <td class="mdl-data-table__cell--non-numeric">
                      Projected Units
                    </td>
                    <td>3,824</td>
                    <td>3,258</td>
                    <td>2,782</td>
                    <td>2,382</td>
                    <td>2,045</td>
                    <td>1,762</td>
                    <td>1,524</td>
                    <td>1,325</td>
                    <td>1,159</td>
                    <td>1,020</td>
                    <td>904</td>
                  </tr>
                  <tr>
                    <td
                      id="sortButton"
                      class="mdl-data-table__cell--non-numeric"
                    >
                      Projected Sales Dollars (click to sort)
                    </td>
                    <td>$1,6213</td>
                    <td>$1,7076</td>
                    <td>$1,7364</td>
                    <td>$1,7247</td>
                    <td>$1,6853</td>
                    <td>$1,6283</td>
                    <td>$1,5613</td>
                    <td>$1,4900</td>
                    <td>$1,4187</td>
                    <td>$1,3504</td>
                    <td>$1,2874</td>
                  </tr>
                  <tr>
                    <td class="mdl-data-table__cell--non-numeric">
                      Projected IMU
                    </td>
                    <td>42%</td>
                    <td>47%</td>
                    <td>52%</td>
                    <td>55%</td>
                    <td>58%</td>
                    <td>61%</td>
                    <td>64%</td>
                    <td>66%</td>
                    <td>68%</td>
                    <td>69%</td>
                    <td>71%</td>
                  </tr>
                  <tr>
                    <td class="mdl-data-table__cell--non-numeric">
                      Ranking by profit
                    </td>
                    <td>6</td>
                    <td class="price-ranking-3">3</td>
                    <td class="price-ranking-1">1</td>
                    <td class="price-ranking-2">2</td>
                    <td>4</td>
                    <td>5</td>
                    <td>7</td>
                    <td>8</td>
                    <td class="price-ranking-9">9</td>
                    <td class="price-ranking-10">10</td>
                    <td class="price-ranking-11">11</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Promotional Calendar Section -->
          <div class="mdl-card mdl-shadow--2dp content-card">
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text">Price History</h2>
            </div>
            <div class="mdl-card__supporting-text">
              <p>
                Below you can view last seasons pricing at a promotion event
                level or a daily level.
              </p>
            </div>
            <div class="mdl-card__supporting-text">
              <div class="view-toggle">
                <label
                  class="mdl-switch mdl-js-switch mdl-js-ripple-effect"
                  for="view-toggle"
                >
                  <input
                    type="checkbox"
                    id="view-toggle"
                    class="mdl-switch__input"
                  />
                  <span class="mdl-switch__label">View by day</span>
                </label>
              </div>

              <div id="yearly-view">
                <h4>Last Year (Spring 2024)</h4>
                <table
                  class="mdl-data-table mdl-js-data-table"
                  id="promotions-data-2024"
                >
                  <thead>
                    <tr>
                      <th class="mdl-data-table__cell--non-numeric">
                        Promotion
                      </th>
                      <th>Price</th>
                      <th>AUR</th>
                      <th class="mdl-data-table__cell--non-numeric">Dates</th>
                      <th>Units</th>
                      <th>Sales</th>
                      <th class="mdl-data-table__cell--non-numeric">Notes</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="year-group-2024">
                      <td class="mdl-data-table__cell--non-numeric">
                        Regular Price
                      </td>
                      <td>$19.99</td>
                      <td>$13.78.00</td>
                      <td class="mdl-data-table__cell--non-numeric">
                        Jan 1 - Feb 2
                      </td>
                      <td>50,000</td>
                      <td>$1,000,000.00</td>
                      <td
                        class="mdl-data-table__cell--non-numeric notes-column"
                      >
                        <div
                          contenteditable="true"
                          class="editable-notes"
                          data-table="promotions"
                        ></div>
                      </td>
                    </tr>

                    <tr class="year-group-2024">
                      <td class="mdl-data-table__cell--non-numeric">
                        Main Sale
                      </td>
                      <td>$14.99</td>
                      <td>$8.54</td>
                      <td class="mdl-data-table__cell--non-numeric">
                        Feb 23 - Feb 26
                      </td>
                      <td>10,000</td>
                      <td>$150,000.00</td>
                      <td
                        class="mdl-data-table__cell--non-numeric notes-column"
                      >
                        <div
                          contenteditable="true"
                          class="editable-notes"
                          data-table="promotions"
                        ></div>
                      </td>
                    </tr>
                    <tr class="year-group-2024">
                      <td class="mdl-data-table__cell--non-numeric">LPS</td>
                      <td>$12.99</td>
                      <td>$6.40</td>
                      <td class="mdl-data-table__cell--non-numeric">
                        Mar 1 - Mar 3
                      </td>
                      <td>50,000</td>
                      <td>$1,000,000.00</td>
                      <td
                        class="mdl-data-table__cell--non-numeric notes-column"
                      >
                        <div
                          contenteditable="true"
                          class="editable-notes"
                          data-table="promotions"
                        ></div>
                      </td>
                    </tr>
                    <tr class="year-group-2024">
                      <td class="mdl-data-table__cell--non-numeric">
                        Epic Deals
                      </td>
                      <td>$10.99</td>
                      <td>$7.70</td>
                      <td class="mdl-data-table__cell--non-numeric">
                        Mar 16 - Mar 22
                      </td>
                      <td>50,000</td>
                      <td>$1,000,000.00</td>
                      <td
                        class="mdl-data-table__cell--non-numeric notes-column"
                      >
                        <div
                          contenteditable="true"
                          class="editable-notes"
                          data-table="promotions"
                        ></div>
                      </td>
                    </tr>
                    <tr class="year-group-2024">
                      <td class="mdl-data-table__cell--non-numeric">
                        Credit Event
                      </td>
                      <td>$15.99</td>
                      <td>$10.02</td>
                      <td class="mdl-data-table__cell--non-numeric">
                        Apr 4 - Apr 7
                      </td>
                      <td>50,000</td>
                      <td>$1,000,000.00</td>
                      <td
                        class="mdl-data-table__cell--non-numeric notes-column"
                      >
                        <div
                          contenteditable="true"
                          class="editable-notes"
                          data-table="promotions"
                        ></div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <div id="weekly-view" style="display: none">
                <table
                  class="mdl-data-table mdl-js-data-table"
                  id="weekly-data"
                >
                  <thead>
                    <tr>
                      <th class="mdl-data-table__cell--non-numeric">Week</th>
                      <th>Price</th>
                      <th>AUR</th>
                      <th>Units</th>
                      <th>Revenue</th>
                      <th>Inventory</th>
                      <th>MMU</th>
                      <th class="mdl-data-table__cell--non-numeric">
                        Promotion
                      </th>
                      <th
                        class="mdl-data-table__cell--non-numeric notes-column"
                      >
                        Notes
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Weekly data will be populated here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Combined Forecasting and This Year Projected Card -->
          <div class="mdl-card mdl-shadow--2dp content-card">
            <div class="mdl-card__title">
              <h2 class="mdl-card__title-text">Forecasting (Spring 2025)</h2>
            </div>
            <div class="mdl-card__supporting-text">
              <p>
                This tool enables you to choose last season's event and manually
                forecast what a different price point may produce in the
                upcoming season. After calculating the forecast for the price
                point results, if you like the results you can populate them in
                the This Year Plan table below.
              </p>

              <!-- Forecasting Form -->
              <form id="forecast-form" class="forecast-form">
                <div
                  class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label"
                >
                  <select class="mdl-textfield__input" id="promotion-select">
                    <!-- Options will be populated by JavaScript -->
                  </select>
                  <label class="mdl-textfield__label" for="promotion-select"
                    >Select Promotion</label
                  >
                </div>
                <div
                  class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label"
                >
                  <input
                    class="mdl-textfield__input"
                    type="number"
                    id="price"
                    step="0.01"
                    min="0"
                  />
                  <label class="mdl-textfield__label" for="price"
                    >Enter New Price</label
                  >
                </div>
                <br />
                <button
                  type="submit"
                  class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent"
                >
                  Calculate Forecast
                </button>
              </form>
              <div id="forecast-results" class="forecast-results">
                <br />
                <p>Projected Units: <span id="calculated-units"></span></p>
                <p>Projected Revenue: <span id="calculated-revenue"></span></p>
              </div>
              <button
                type="button"
                id="update-table"
                class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--primary"
                disabled
              >
                Update Table with New Forecast
              </button>

              <!-- This Year Projected Table -->
              <h4>This Year Projected (Spring 2025)</h4>
              <table
                class="mdl-data-table mdl-js-data-table"
                id="promotions-data"
              >
                <thead>
                  <tr>
                    <th class="mdl-data-table__cell--non-numeric">Promotion</th>
                    <th>Price</th>
                    <th>AUR</th>
                    <th>Units</th>
                    <th>Sales</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Promotion rows will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Material Design Lite JavaScript -->
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

    <!-- Custom JavaScript -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM fully loaded and parsed");

        // White Ticket Section
        let ascending = true;
        const sortButton = document.getElementById("sortButton");
        if (sortButton) {
          sortButton.addEventListener("click", sortColumns);
        }

        function sortColumns() {
          const table = document.getElementById("white-ticket-table");
          const rows = Array.from(table.rows);
          const priceRankingRow = rows[rows.length - 1];
          const headerRow = rows[0];
          const columns = Array.from(priceRankingRow.cells).slice(1);

          columns.sort((a, b) => {
            const rankA = parseInt(a.textContent);
            const rankB = parseInt(b.textContent);
            return ascending ? rankA - rankB : rankB - rankA;
          });

          for (let i = 0; i < columns.length; i++) {
            const columnIndex = columns[i].cellIndex;
            for (let j = 0; j < rows.length; j++) {
              const cell = rows[j].cells[columnIndex];
              rows[j].appendChild(cell);
            }
          }

          ascending = !ascending;
        }

        // DOM elements
        const form = document.getElementById("forecast-form");
        const updateTableButton = document.getElementById("update-table");
        const promotionSelect = document.getElementById("promotion-select");
        const promotionsTable = document.getElementById("promotions-data");
        const priceInput = document.getElementById("price");
        const calculatedUnitsElement =
          document.getElementById("calculated-units");
        const calculatedRevenueElement =
          document.getElementById("calculated-revenue");
        const viewToggle = document.getElementById("view-toggle");
        const yearlyView = document.getElementById("yearly-view");
        const weeklyView = document.getElementById("weekly-view");

        // State variables
        let calculatedUnits, calculatedRevenue;
        let currentProduct = { price: 19.99 };

        /* This is the This Year Projected (Spring 2025)
 sample data */

        // Sample promotions data
        const promotions = [
          { name: "Regular Price", currentPrice: 2, discount: 0 },
          { name: "LPS", currentPrice: 3, discount: 0 },
          { name: "Two Day Sale", currentPrice: 4, discount: 0 },
          { name: "EPIC deals", currentPrice: 3, discount: 0 },
          { name: "Credit Event", currentPrice: 3, discount: 0 },
          { name: "Summer Sale", currentPrice: 3, discount: 0 },
          { name: "Black Friday", currentPrice: 3, discount: 0 },
        ];

        // Event Listeners
        if (form) form.addEventListener("submit", handleForecastSubmit);
        if (updateTableButton)
          updateTableButton.addEventListener("click", updateTablesAndClear);
        if (viewToggle) viewToggle.addEventListener("change", toggleView);

        // Initialize
        populatePromotionDropdown();
        populatePromotionsTable();

        function handleForecastSubmit(e) {
          e.preventDefault();
          const price = parseFloat(priceInput.value);

          calculatedUnits = Math.round(100000 / price);
          calculatedRevenue = price * calculatedUnits;

          calculatedUnitsElement.textContent = calculatedUnits.toLocaleString();
          calculatedRevenueElement.textContent =
            "$" +
            calculatedRevenue.toLocaleString(undefined, {
              minimumFractionDigits: 2,
              maximumFractionDigits: 2,
            });

          updateTableButton.disabled = false;
        }

        function updatePromotionData(index, newPrice) {
          promotions[index].currentPrice = newPrice;
        }

        function updateTablesAndClear() {
          const price = parseFloat(priceInput.value);
          const selectedPromoIndex = parseInt(promotionSelect.value);

          if (selectedPromoIndex < promotions.length) {
            promotions[selectedPromoIndex].currentPrice = price;
            promotions[selectedPromoIndex].units = calculatedUnits;
            promotions[selectedPromoIndex].sales = calculatedRevenue;
            promotions[selectedPromoIndex].AUR = calculateAUR(price);
          }

          populatePromotionsTable();
          populatePromotionDropdown();

          calculatedUnits = null;
          calculatedRevenue = null;
          calculatedUnitsElement.textContent = "";
          calculatedRevenueElement.textContent = "";
          priceInput.value = "";

          updateTableButton.disabled = true;
          priceInput.parentElement.classList.remove("is-dirty");
        }

        function addPriceEventListeners() {
          console.log("Adding price event listeners");
          const tbody = promotionsTable.querySelector("tbody");
          tbody.addEventListener("input", function (e) {
            if (e.target && e.target.cellIndex === 1) {
              console.log("Price cell edited");
              const row = e.target.parentElement;
              const priceCell = e.target;
              const aurCell = row.cells[2];
              const price = parseFloat(priceCell.textContent.replace("$", ""));
              if (!isNaN(price)) {
                const AUR = calculateAUR(price);
                aurCell.textContent = "$" + AUR.toFixed(2);
              }
            }
          });
        }

        function populatePromotionDropdown() {
          promotionSelect.innerHTML = "";
          promotions.forEach((promo, index) => {
            const option = document.createElement("option");
            option.value = index;
            const price =
              promo.currentPrice ||
              (currentProduct
                ? currentProduct.price * (1 - promo.discount)
                : 0);
            let dateRange = "";
            if (promo.startDate && promo.endDate) {
              dateRange = ` (${promo.startDate} to ${promo.endDate})`;
            }
            option.textContent = `${
              promo.name
            }${dateRange} (Current: $${price.toFixed(2)})`;
            promotionSelect.appendChild(option);
          });
        }

        function populatePromotionsTable() {
          console.log("Populating promotions table");
          try {
            const tbody = promotionsTable.querySelector("tbody");
            tbody.innerHTML = "";

            promotions.forEach((promo, index) => {
              const row = tbody.insertRow();
              const price =
                promo.currentPrice ||
                (currentProduct
                  ? currentProduct.price * (1 - promo.discount)
                  : 0);
              const AUR = calculateAUR(price);
              const units = promo.units || 30000;
              const sales = promo.sales || price * units;
              row.innerHTML = `
                <td class="mdl-data-table__cell--non-numeric">${promo.name}</td>
                <td>$${price.toFixed(2)}</td>
                <td>$${AUR.toFixed(2)}</td>
                <td>${units.toLocaleString()}</td>
                <td>$${sales.toFixed(2)}</td>
                <td class="mdl-data-table__cell--non-numeric notes-column">
                    <div contenteditable="true" class="editable-notes" data-table="promotions" data-row="${index}">${
                promo.notes || ""
              }</div>
                </td>
            `;
            });

            addPriceEventListeners();
          } catch (error) {
            console.error("Error in populatePromotionsTable:", error);
          }
        }
        function calculateAUR(price) {
          return price * 0.62;
        }

        function toggleView() {
          if (viewToggle.checked) {
            yearlyView.style.display = "none";
            weeklyView.style.display = "block";
            populateWeeklyData();
          } else {
            yearlyView.style.display = "block";
            weeklyView.style.display = "none";
          }
        }

        /* This is the WEEKLY (SPRING 2024) sample data */

        function populateWeeklyData() {
          const weeklyData = [
            {
              week: 1,
              price: 14.99,
              AUR: 14.99 * 0.62,
              units: 577,
              revenue: 46155.23,
              inventory: 10000,
              mmu: "50%",
              promotion: "Regular Price",
              notes: "",
            },
            {
              week: 2,
              price: 14.99,
              AUR: 14.99 * 0.62,
              units: 592,
              revenue: 47354.08,
              inventory: 9408,
              mmu: "50%",
              promotion: "Regular Price",
              notes: "",
            },
            {
              week: 5,
              price: 14.99,
              AUR: 14.99 * 0.62,
              units: 600,
              revenue: 47994.0,
              inventory: 8808,
              mmu: "50%",
              promotion: "Regular Price",
              notes: "",
            },
            {
              week: 9,
              price: 11.99,
              AUR: 11.99 * 0.62,
              units: 800,
              revenue: 59992.0,
              inventory: 8008,
              mmu: "45%",
              promotion: "Spring Sale",
              notes: "",
            },
            {
              week: 14,
              price: 11.99,
              AUR: 11.99 * 0.62,
              units: 850,
              revenue: 63741.5,
              inventory: 7158,
              mmu: "45%",
              promotion: "Spring Sale",
              notes: "",
            },
            {
              week: 18,
              price: 13.99,
              AUR: 13.99 * 0.62,
              units: 1000,
              revenue: 69990.0,
              inventory: 6158,
              mmu: "40%",
              promotion: "Memorial Day Sale",
              notes: "",
            },
            {
              week: 22,
              price: 14.99,
              AUR: 14.99 * 0.62,
              units: 1200,
              revenue: 71988.0,
              inventory: 4958,
              mmu: "35%",
              promotion: "Summer Kickoff",
              notes: "",
            },
            {
              week: 27,
              price: 14.99,
              AUR: 14.99 * 0.62,
              units: 1100,
              revenue: 71489.0,
              inventory: 3858,
              mmu: "40%",
              promotion: "Independence Day Sale",
              notes: "",
            },
            {
              week: 31,
              price: 13.99,
              AUR: 13.99 * 0.62,
              units: 950,
              revenue: 66490.5,
              inventory: 2908,
              mmu: "45%",
              promotion: "Back to School",
              notes: "",
            },
            {
              week: 36,
              price: 11.99,
              AUR: 11.99 * 0.62,
              units: 800,
              revenue: 59992.0,
              inventory: 2108,
              mmu: "50%",
              promotion: "Fall Collection Launch",
              notes: "",
            },
            {
              week: 40,
              price: 14.99,
              AUR: 14.99 * 0.62,
              units: 700,
              revenue: 55993.0,
              inventory: 1408,
              mmu: "50%",
              promotion: "Regular Price",
              notes: "",
            },
            {
              week: 45,
              price: 14.99,
              AUR: 14.99 * 0.62,
              units: 1500,
              revenue: 89985.0,
              inventory: -92,
              mmu: "30%",
              promotion: "Black Friday",
              notes: "",
            },
            {
              week: 49,
              price: 13.99,
              AUR: 13.99 * 0.62,
              units: 1000,
              revenue: 69990.0,
              inventory: -1092,
              mmu: "40%",
              promotion: "Holiday Sale",
              notes: "",
            },
          ];

          const tbody = document.querySelector("#weekly-data tbody");
          tbody.innerHTML = "";
          weeklyData.forEach((week, index) => {
            const weekRow = tbody.insertRow();
            weekRow.classList.add("week-row");
            weekRow.innerHTML = `
            <td class="mdl-data-table__cell--non-numeric">
                <i class="material-icons expand-icon">add_circle_outline</i> Week ${
                  week.week
                }
            </td>
            <td>$${week.price.toFixed(2)}</td>
            <td>$${week.AUR.toFixed(2)}</td>
            <td>${week.units.toLocaleString()}</td>
            <td>$${week.revenue.toFixed(2)}</td>
            <td>${week.inventory.toLocaleString()}</td>
            <td>${week.mmu}</td>
            <td class="mdl-data-table__cell--non-numeric">${week.promotion}</td>
            <td class="mdl-data-table__cell--non-numeric notes-column">
                <div contenteditable="true" class="editable-notes" data-table="weekly" data-row="${index}">${
              week.notes
            }</div>
            </td>
        `;

            // Add click event to expand/collapse
            weekRow
              .querySelector(".expand-icon")
              .addEventListener("click", function () {
                toggleDailyData(this, week.week);
              });

            // Create a row for daily data (initially hidden)
            const dailyRow = tbody.insertRow();
            dailyRow.classList.add("daily-data");
            dailyRow.style.display = "none";
            dailyRow.innerHTML = `
            <td colspan="9">
                <table class="mdl-data-table mdl-js-data-table daily-table">
                    <thead>
                        <tr>
                            <th>Day</th> 
                            <th>Price</th>
                            <th>Units</th>
                            <th>Revenue</th>
                            <th>Marketing</th>
                            <th>Promotion</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Daily data will be populated here -->
                    </tbody>
                </table>
            </td>
        `;
          });

          addTotals(weeklyData);
        }

        function addTotals(data) {
          const totals = data.reduce(
            (acc, week) => {
              acc.units += week.units;
              acc.revenue += week.revenue;
              return acc;
            },
            { units: 0, revenue: 0 }
          );

          const tbody = document.querySelector("#weekly-data tbody");
          const totalRow = tbody.insertRow();
          totalRow.innerHTML = `
        <td colspan="3" class="mdl-data-table__cell--non-numeric"><strong>Total</strong></td>
        <td><strong>${totals.units.toLocaleString()}</strong></td>
        <td><strong>$${totals.revenue.toFixed(2)}</strong></td>
        <td colspan="4"></td>
    `;
        }

        function toggleDailyData(icon, weekNumber) {
          const weekRow = icon.closest("tr");
          const dailyRow = weekRow.nextElementSibling;
          const isExpanded = icon.textContent === "remove_circle_outline";

          if (isExpanded) {
            icon.textContent = "add_circle_outline";
            dailyRow.style.display = "none";
          } else {
            icon.textContent = "remove_circle_outline";
            dailyRow.style.display = "table-row";
            populateDailyData(dailyRow, weekNumber);
          }
        }

        function populateDailyData(dailyRow, weekNumber) {
          const dailyTable = dailyRow.querySelector(".daily-table tbody");
          dailyTable.innerHTML = "";

          /* This is the weekly DAILY (SPRING 2024) sample data */

          // Sample daily data - replace with your actual data
          const dailyData = [
            {
              day: "Monday",
              price: 14.99,
              units: 100,
              revenue: 7999,
              marketing: "Mystery Offer 45%",
              promotion: "Regular Price",
            },
            {
              day: "Tuesday",
              price: 14.99,
              units: 95,
              revenue: 7599.05,
              marketing: "Mystery Offer 45%",
              promotion: "Regular Price",
            },
            {
              day: "Wednesday",
              price: 14.99,
              units: 105,
              revenue: 8398.95,
              marketing: "Mystery Offer 45%",
              promotion: "Regular Price",
            },
            {
              day: "Thursday",
              price: 11.99,
              units: 90,
              revenue: 6749.1,
              marketing: "Mystery Offer 45%",
              promotion: "Credit Event",
            },
            {
              day: "Friday",
              price: 11.99,
              units: 110,
              revenue: 8248.9,
              marketing: "Mystery Offer 45%",
              promotion: "Credit Event",
            },
            {
              day: "Saturday",
              price: 14.99,
              units: 130,
              revenue: 10398.7,
              marketing: "Mystery Offer 45%",
              promotion: "Three day sale",
            },
            {
              day: "Sunday",
              price: 14.99,
              units: 120,
              revenue: 9598.8,
              marketing: "Mystery Offer 45%",
              promotion: "Epic Deals",
            },
          ];

          dailyData.forEach((day) => {
            const row = dailyTable.insertRow();
            const AUR = day.price * 0.62;
            row.innerHTML = `
            <td>${day.day}</td>
            <td>$${day.price.toFixed(2)}</td>
            <td>${day.units}</td>
            <td>$${day.revenue.toFixed(2)}</td>
            <td>${day.marketing}</td>
            <td>${day.promotion}</td>
        `;
          });
        }

        // Product search functionality
        const productSearch = document.getElementById("product-search");
        const autocompleteResults = document.getElementById(
          "autocomplete-results"
        );
        /* This is the SELECT STYLE Search style code sample data */

        const products = [
          {
            code: "58775216",
            name: "MEN'S NIKE DRI FIT FORM HOODED JACKET",
            price: 19.99,
          },
          { code: "50093716", name: "NIKE STAR RUNNER NN", price: 14.99 },
          { code: "58730148", name: "BOYS RAIN JACKET", price: 11.99 },
          { code: "83178349", name: "FITBIT CHARGE 6 BLACK", price: 13.99 },
          {
            code: "77404421",
            name: "Nike Sportswear Essential Women's Leggings",
            price: 14.99,
          },
        ];

        if (productSearch) {
          productSearch.addEventListener("input", handleProductSearch);
          productSearch.addEventListener("focus", handleProductFocus);
          productSearch.addEventListener("input", handleProductInput);
        }
        document.addEventListener("click", closeAutocomplete);

        function handleProductSearch() {
          const input = this.value.toLowerCase();
          const results = products.filter(
            (product) =>
              product.code.toLowerCase().includes(input) ||
              product.name.toLowerCase().includes(input)
          );
          displayAutocompleteResults(results);
        }

        function handleProductFocus() {
          if (this.value === "") {
            displayAutocompleteResults(products);
          }
        }

        function handleProductInput() {
          if (this.value.length > 0) {
            this.parentElement.classList.add("is-dirty");
          } else {
            this.parentElement.classList.remove("is-dirty");
          }
        }

        function displayAutocompleteResults(results) {
          autocompleteResults.innerHTML = "";
          if (results.length === 0) {
            autocompleteResults.style.display = "none";
            return;
          }

          results.forEach((result) => {
            const div = document.createElement("div");
            div.textContent = `${result.code} - ${result.name}`;
            div.className =
              "autocomplete-item mdl-button mdl-js-button mdl-js-ripple-effect";
            div.addEventListener("click", () => selectProduct(result));
            autocompleteResults.appendChild(div);
          });

          autocompleteResults.style.display = "block";
        }

        function selectProduct(product) {
          currentProduct = product;
          productSearch.value = `${product.code} - ${product.name}`;
          autocompleteResults.style.display = "none";
          productSearch.parentElement.classList.add("is-dirty");
          componentHandler.upgradeElement(productSearch.parentElement);
          document.getElementById("selected-style").innerHTML =
            productSearch.value;
          console.log("Selected product:", product);
        }

        function closeAutocomplete(e) {
          if (
            !productSearch.contains(e.target) &&
            !autocompleteResults.contains(e.target)
          ) {
            autocompleteResults.style.display = "none";
          }
        }
      });
    </script>
  </body>
</html>
